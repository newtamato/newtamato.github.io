
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Lua脚本在C++下的舞步(入门指引)（转） - 番茄手册</title>
  <meta name="author" content="newtomato">

  
  <meta name="description" content="转帖来自：http://www.acejoy.com/bbs/viewthread.php?tid=1931&amp;extra=page%3D1 现在，越来越多的C++服务器和客户端融入了脚本的支持，尤其在网游领域，脚本语言已经渗透到了方方面面，比如你可以在你的客户端增加一个脚本， &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://www.newtomato.me/blog/2015/11/12/lua-deep">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="番茄手册" type="application/atom+xml">
  <link href='http://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <div id="logo">
  	<div id="logoLeft">{</div>
  	<div id="logoText">think</div>
  	<div id="logoRight">}</div>
  	<div class="clear"></div>
  </div>
  <h1><a href="/">番茄手册</a></h1>
  
  <div class="clear"></div>
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:www.newtomato.me" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
   <li><a href="/about2">About</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      
        <h1 class="entry-title">Lua脚本在C++下的舞步(入门指引)（转）</h1>
      
    
    
      <p class="meta">
        








  


<time datetime="2015-11-12T21:46:51+08:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


<div class="entry-content"><p>转帖来自：http://www.acejoy.com/bbs/viewthread.php?tid=1931&amp;extra=page%3D1</p>

<p>现在，越来越多的C++服务器和客户端融入了脚本的支持，尤其在网游领域，脚本语言已经渗透到了方方面面，比如你可以在你的客户端增加一个脚本，这个脚本将会帮你在界面上显示新的数据，亦或帮你完成某些任务，亦或帮你查看别的玩家或者NPC的状态。。。如此等等。</p>

<p>但是我觉得，其实脚本语言与C++的结合，远远比你在游戏中看到的特效要来的迅猛。它可以运用到方方面面的领域，比如你最常见的应用领域。比如，你可以用文本编辑器，写一个脚本语言，然后用你的程序加载一下，就会产生出很绚丽的界面。亦或一两句文本语言，就会让你的程序发送数据给服务器，是不是很酷呢？</p>

<!--more-->

<p>本来我想，写一篇关于主流脚本语言Lua和Python的文章，但是感觉这样过于乏味，于是分开来一一介绍，相信对C++了解的你，看过我的文章后会对脚本语言这种东西产生浓厚的兴趣，我想起以前听的一个故事，当年Java的创造者讲课的时候，一开始先拿一个简单的不能简单的小例子，不断的扩展，最后成为一个复杂而完美的程序。今天我也就这样实验一下吧，呵呵。</p>

<p>当然，我本人不敢说对脚本语言了如指掌，只能说略微掌握一些，用过几年，偏颇之处请大家指正。 <br />
下面，开始吧，先说LUA！（本文面向初学者）<br />
<a href="http://www.lua.org/">Lua语言</a>,想必不少人都听过，据我所知，由于《魔兽世界》里面对它的加载，它一下子变成了很多游戏开发者竞相研究的对象，至于这个巴西创造者么，我不过多介绍，大家有兴趣可以谷歌一下。其实网上有很多关于lua的教材和例子，说真的，对于当年的我而言，几乎看不懂，当时很郁闷，感觉Lua复杂的要命，有些惧怕，后来沉下心来一点点研究，觉得其实还是蛮简洁的。只是网上的资料或许偏向于某些功能，导致了逻辑和代码的复杂。后来总结，其实学习一种脚本语言，完全可以抱着放松的心态一点点的研究，反而效果会更好。</p>

<p>在讲代码之前，我要说Lua的一些特点，这些特点有利于你在复杂的代码调用中，清晰的掌握中间的来龙去脉。实际上，你能常常用到的lua的API，不过超过10个，再复杂的逻辑。基本上也是这么多API组成的。至于它们是什么，下面的文章会介绍。另外一个重要之重要的概念，就是栈。Lua与别的语言交互以及交换数据，是通过栈完成的。其实简单的解释一下，你可以把栈想象成一个箱子，你要给他数据，就要按顺序一个个的把数据放进去，当然，Lua执行完毕，可能会有结果返回给你，那么Lua还会利用你的箱子，一个个的继续放下去。而你取出返回数据呢，要从箱子顶上取出，如果你想要获得你的输入参数呢？那也很简单，按照顶上返回数据的个数，再按顺序一个个的取出，就行了。不过这里提醒大家，关于栈的位置，永远是相对的，比如-1代表的是当前栈顶，-2代表的是当前栈顶下一个数据的位置。栈是数据交换的地方，一定要有一些栈的概念。</p>

<p>好了，基础的lua语法不在这里讲，百度一下有很多。 <br />
先去http://www.lua.org/ 去下载一个最新的Lua代码（现在稳定版是lua-5.1.4）。它的代码是用C写的，所以很容易兼容很多平台。</p>

<p>在linux下，目录src下就有专门的Makefile。很简单，啥都不用做，指定一下位置编译即可。 <br />
在windows下，以VS2005为例，建立一个空的静态库工程（最好不使用预编译头，把预编译头的选项勾去掉），然后把src下的所有文件（除了Makefile）一股脑拷到工程中去。然后将这些文件添加到你的工程中，编译，会生成一个<em>.llib(</em>是你起的lua库名)，行了，建立一个目录lib，把它拷过去，然后再建立一个include的文件夹，把你工程目录下的lua.h，lualib.h，lauxlib.h，拷贝过去。行了，拿着这两个文件夹，你就可以在你的工程里使用lua了。 <br />
行了，材料齐了，我们来看看怎么写一个简单的lua程序吧。<br />
建立一个文件，起名Sample.lua <br />
里面添加这样的代码。</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class=""><span class="line">function func_Add(x, y) 
</span><span class="line">   return x+y; 
</span><span class="line">end</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>这是一个标准的lua语法，一个函数，实现简单的a+b操作，并返回操作结果。 <br />
保存退出。 <br />
多一句嘴，在Lua里面，是可以支持多数据返回的。 <br />
比如你这么写：</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class=""><span class="line">function func_Add(x, y) 
</span><span class="line">   return x+y, x-y; 
</span><span class="line">end</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>意思是返回第一个参数是相加的结果，第二个是相减的结果，也是可以的。在lua里面没有类型的概念。当然，在C++接受这样的返回值的时候，也很简单，请往下看。 <br />
好了，材料齐备了，咱们来看看C++程序怎么调用它。 <br />
首先，建立一个类，负责加载这个lua文件，并执行函数操作，我们姑且叫做CLuaFn <br />
要加载这个lua文件，按照正常的思路，我们应该先加载，然后再调用不同的函数。恩，对了，咱们就这么做。</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
</pre></td><td class="code"><pre><code class=""><span class="line">extern “C” 
</span><span class="line">{ 
</span><span class="line">        #include “lua.h” 
</span><span class="line">        #include “lualib.h” 
</span><span class="line">        #include “lauxlib.h” 
</span><span class="line">};
</span><span class="line">
</span><span class="line">class CLuaFn 
</span><span class="line">{ 
</span><span class="line">public: 
</span><span class="line">        CLuaFn(void); 
</span><span class="line">        ~CLuaFn(void);
</span><span class="line">
</span><span class="line">        void Init();            //初始化Lua对象指针参数 
</span><span class="line">        void Close();         //关闭Lua对象指针
</span><span class="line">
</span><span class="line">		//加载指定的Lua文件 
</span><span class="line">        bool LoadLuaFile(const char* pFileName); 
</span><span class="line">        //执行指定Lua文件中的函数
</span><span class="line">        bool CallFileFn(const char* pFunctionName, int nParam1, int nParam2);
</span><span class="line">private: 
</span><span class="line">        lua_State* m_pState;   //这个是Lua的State对象指针，你可以一个lua文件对应一个。 
</span><span class="line">};</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>恩，头文件就这么多，看看，一点也不复杂吧，看了cpp我想你会更高兴，因为代码一样很少。我一个个函数给你们介绍。</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
</pre></td><td class="code"><pre><code class=""><span class="line">void CLuaFn::Init() 
</span><span class="line">{ 
</span><span class="line">        if(NULL == m_pState) 
</span><span class="line">        { 
</span><span class="line">                m_pState = lua_open(); 
</span><span class="line">                luaL_openlibs(m_pState); 
</span><span class="line">        } 
</span><span class="line">}</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>初始化函数，标准代码，没啥好说的，lua_open()是返回给你一个lua对象指针，luaL_openlibs()是一个好东西，在lua4，初始化要做一大堆的代码，比如加载lua的string库，io库，math库等等等等，代码洋洋洒洒一大堆，其实都是不必要的，因为这些库你基本都需要用到，除了练习你的打字能力别的意义不大，因为代码写法都是固定的。于是在5以后，Lua的创造者修改了很多，这就是其一，一句话帮你加载了所有你可能用到的Lua基本库。</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
</pre></td><td class="code"><pre><code class=""><span class="line">void CLuaFn::Close() 
</span><span class="line">{ 
</span><span class="line">        if(NULL != m_pState) 
</span><span class="line">        { 
</span><span class="line">                lua_close(m_pState); 
</span><span class="line">                m_pState = NULL; 
</span><span class="line">        } 
</span><span class="line">}</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>顾名思义，我用完了，关闭我的Lua对象并释放资源。呵呵，标准写法，没啥好说的。</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
</pre></td><td class="code"><pre><code class=""><span class="line">bool CLuaFn:: LoadLuaFile(const char* pFileName) 
</span><span class="line">{ 
</span><span class="line">        int nRet = 0; 
</span><span class="line">        if(NULL == m_pState) 
</span><span class="line">        { 
</span><span class="line">                printf(“[CLuaFn:: LoadLuaFile]m_pState is NULL./n”); 
</span><span class="line">                return false; 
</span><span class="line">        }
</span><span class="line">
</span><span class="line">        nRet = luaL_dofile(m_pState, pFileName); 
</span><span class="line">        if (nRet != 0) 
</span><span class="line">        { 
</span><span class="line">                printf(“[CLuaFn:: LoadLuaFile]luaL_loadfile(%s) is file(%d)(%s)./n”, pFileName, nRet, lua_tostring(m_pState, -1)); 
</span><span class="line">                return false; 
</span><span class="line">        }
</span><span class="line">
</span><span class="line">        return true; 
</span><span class="line">}</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>呵呵，这个有点意思，加载一个Lua文件。 <br />
这里我要详细的说一下，因为Lua是脚本语言，加载lua文件本身的时候才会编译。 <br />
所以，推荐大家在加载文件的时候尽量放在程序的初始化中，因为当你执行luaL_dofile()函数的时候，Lua会启用语法分析器，去分析你的脚本语法是否符合Lua规则，如果你胡乱的传一个文件过去，Lua就会告诉你文件语法错误，无法加载。如果你的Lua脚本很大，函数很多，语法分析器会比较耗时，所以，加载的时候，尽量放在合适的地方，而且，对于一个Lua文件而言，反复加载luaL_dofile()除了会使你的CPU变热没有任何意义。</p>

<p>许你对printf(“[CLuaFn:: LoadLuaFile]luaL_loadfile(%s) is file(%d)(%s)./n”, pFileName, nRet, lua_tostring(m_pState, -1));这句话很感兴趣，这个在干什么？这里我先说lua_tostring(m_pState, -1)这是在干什么，还记得我说的Lua是基于栈传输数据的么？那么，如果报错，我怎么知道错误是什么？luaL_dofile标准返回一个int，我总不能到lua.h里面遍历这个nRet 是啥意思吧，恩，Lua创造者早就为你想好了，只不过你需要稍微动一下你的脑筋。Lua的创造者在语法分析器分析你的语法的时候，发现错误，会有一段文字告诉你是什么错误，它会把这个字符串放在栈顶。那么，怎么取得栈顶的字符串呢？lua_tostring(m_pState, -1)就可以，-1代表的是当前栈的位置是相对栈顶。当然，你也可以看看栈里面还有一些什么其他古怪的数据，你可以用1,2,3（这些是绝对位置，而-1是相对位置）去尝试，呵呵。不过，相信你得到的也很难看懂，因为一个Lua对象执行的时候，会用很多次栈进行数据交换，而你看到的，有可能是交换中的数据。那么，话说回来，这句话的意思就是”[CLuaFn:: LoadLuaFile]luaL_loadfile(文件名) is file(错误编号)(错误具体描述文字)./n”</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
</pre></td><td class="code"><pre><code class=""><span class="line">bool CLuaFn::CallFileFn(const char* pFunctionName, int nParam1, int nParam2) 
</span><span class="line">{ 
</span><span class="line">        int nRet = 0; 
</span><span class="line">        if(NULL == m_pState) 
</span><span class="line">        { 
</span><span class="line">                printf(“[CLuaFn::CallFileFn]m_pState is NULL./n”); 
</span><span class="line">                return false; 
</span><span class="line">        }
</span><span class="line">
</span><span class="line">        lua_getglobal(m_pState, pFunctionName);
</span><span class="line">
</span><span class="line">        lua_pushnumber(m_pState, nParam1); 
</span><span class="line">        lua_pushnumber(m_pState, nParam2);
</span><span class="line">
</span><span class="line">        nRet = lua_pcall(m_pState, 2, 1, 0); 
</span><span class="line">        if (nRet != 0) 
</span><span class="line">        { 
</span><span class="line">                printf(“[CLuaFn::CallFileFn]call function(%s) error(%d)./n”, pFunctionName, nRet); 
</span><span class="line">                return false; 
</span><span class="line">        }
</span><span class="line">
</span><span class="line">        if (lua_isnumber(m_pState, -1) == 1) 
</span><span class="line">        { 
</span><span class="line">                int nSum = lua_tonumber(m_pState, -1); 
</span><span class="line">                printf(“[CLuaFn::CallFileFn]Sum = %d./n”, nSum); 
</span><span class="line">        }
</span><span class="line">
</span><span class="line">        return true; 
</span><span class="line">}</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>这个函数是，传入函数名称和参数，去你的Lua文件中去执行。 <br />
lua_getglobal(m_pState, pFunctionName); <br />
这个函数是验证你的Lua函数是否在你当前加载的Lua文件中，并把指针指向这个函数位置。</p>

<p>lua_pushnumber(m_pState, nParam1);   &lt;—对应你的x参数 <br />
lua_pushnumber(m_pState, nParam2);   &lt;—对应你的y参数</p>

<p>这就是著名的压栈操作了，把你的参数压入Lua的数据栈。供Lua语法器去获得你的数据。 <br />
lua_pushnumber()是一个压入数字，lua_pushstring()是压入一个字符串。。。</p>

<p>那么你会问，如果我有一个自己的类型，一个类指针或者别的什么，我怎么压入？别着急，方法当然是有的，呵呵，不过你先看看如果简单的如何做，在下几讲中，我会告诉你更强大的Lua压栈艺术。 <br />
这里需要注意的是，压栈的顺序，对，简单说，就是从左到右的参数，左边的先进栈，右边的最后进栈。</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class=""><span class="line">nRet = lua_pcall(m_pState, 2, 1, 0); </span></code></pre></td></tr></table></div></figure></notextile></div>

<p>这句话的意思是，执行这个函数，2是输入参数的个数，1是输出参数的个数。当然，如果你把Lua函数改成</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class=""><span class="line">return x+y, x-y; </span></code></pre></td></tr></table></div></figure></notextile></div>

<p>代码需要改成nRet = lua_pcall(m_pState, 2, 2, 0); <br />
明白了吧，呵呵，很简单吧。</p>

<p>当然，如果函数执行失败，会触发nRet，我这里偷了个懒，如果你想得到为什么错了？可以用lua_tostring(m_pState, -1)去栈顶找，明白？是不是有点感觉了？</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class=""><span class="line">lua_isnumber(m_pState, -1) </span></code></pre></td></tr></table></div></figure></notextile></div>

<p>这句话是判定栈顶的元素是不是数字。因为如果执行成功，栈顶就应该是你的数据返回值。</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class=""><span class="line">int nSum = lua_tonumber(m_pState, -1); 
</span><span class="line">printf(“[CLuaFn::CallFileFn]Sum = %d./n”, nSum); </span></code></pre></td></tr></table></div></figure></notextile></div>

<p>这个nSum就是返回的结果。 <br />
当然，你会问，如果 return x+y, x-y;我该怎么办？</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class=""><span class="line">int nSum = lua_tonumber(m_pState, -1); 
</span><span class="line">int nSub = lua_tonumber(m_pState, -2); </span></code></pre></td></tr></table></div></figure></notextile></div>

<p>搞定，看见没。按照压栈顺序。呵呵，是不是又有感觉了，对，栈就是数据交互的核心。对Lua的理解程度和运用技巧，其实就是对栈的灵活运用和操作。</p>

<p>好了。你的第一个Lua程序大功告成！竟然不是Hello world，呵呵。 <br />
好了，我们看看Main函数怎么写吧，相信大家都会写。</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
</pre></td><td class="code"><pre><code class=""><span class="line">#include “LuaFn.h”
</span><span class="line">
</span><span class="line">int _tmain(int argc, _TCHAR* argv[]) 
</span><span class="line">{ 
</span><span class="line">        CLuaFn LuaFn;
</span><span class="line">
</span><span class="line">        //LuaFn.InitClass();
</span><span class="line">
</span><span class="line">        LuaFn.LoadLuaFile(“Sample.lua”); 
</span><span class="line">        LuaFn.CallFileFn(“func_Add”, 11, 12); 
</span><span class="line">        getchar();
</span><span class="line">
</span><span class="line">        return 0; 
</span><span class="line">}</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>行了，Build一下，看看，是不是你要的结果？如果是，贺喜你，你已经迈出了Lua的第一步。 <br />
洋洋洒洒写了一个小时，喝口水吧，呵呵，下一讲，我将强化这个LuaFn类，让它给我做更多的事情。呵呵，最后，我会让你打到，用Lua文件直接画出一个Windows窗体来。并在上面画出各种按钮，列表，以及复选框。是不是感觉很酷？用文本去创造一个程序？很激动吧，恩，确实，Lua能给你做到。只要你有耐心看下去。。。</p>

</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">newtomato</span></span>

      








  


<time datetime="2015-11-12T21:46:51+08:00" pubdate data-updated="true"></time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/c-plus-plus/'>c++</a>, <a class='category' href='/blog/categories/lua/'>lua</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://www.newtomato.me/blog/2015/11/12/lua-deep" data-via="" data-counturl="http://www.newtomato.me/blog/2015/11/12/lua-deep" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left articlenav" href="/blog/2015/11/11/function-closure-upvalue" title="Previous Post: Function, Closures, up values ">&laquo; Function, Closures, up values </a>
      
      
        <a class="basic-alignment right articlenav" href="/blog/2015/11/12/lua-deep-2" title="Next Post: Lua脚本在C++下的舞步（二）">Lua脚本在C++下的舞步（二） &raquo;</a>
      
    </p>
  </footer>
</article>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2018/05/07/androidshi-yong-dumpsysdao-chu-fps">补充在android如何使用dumpsys导出FPS</a>
      </li>
    
      <li class="post">
        <a href="/blog/2018/03/09/2017xiang-mu-zong-jie">大富翁项目总结</a>
      </li>
    
      <li class="post">
        <a href="/blog/2018/02/11/unity-transform-tex">Unity Shader基础函数：TRANSFORM_TEX</a>
      </li>
    
      <li class="post">
        <a href="/blog/2018/02/11/ui-ai">UI测试AI遇到的问题-尚未解决的难题</a>
      </li>
    
      <li class="post">
        <a href="/blog/2018/01/29/openglgldrawarrays">opengl基础之glDrawArrays和glDrawElements之间的区别</a>
      </li>
    
  </ul>
</section>
<section>
 <h1>Categories</h1>
 <ul id="categories">
  <li class='category'><a href='/blog/categories/2d/'>2d (2)</a></li>
<li class='category'><a href='/blog/categories/ads/'>ads (1)</a></li>
<li class='category'><a href='/blog/categories/android/'>android (7)</a></li>
<li class='category'><a href='/blog/categories/androidstudio/'>androidstudio (1)</a></li>
<li class='category'><a href='/blog/categories/android开发/'>android开发 (1)</a></li>
<li class='category'><a href='/blog/categories/apache/'>apache (1)</a></li>
<li class='category'><a href='/blog/categories/apk/'>apk (1)</a></li>
<li class='category'><a href='/blog/categories/atom/'>atom (1)</a></li>
<li class='category'><a href='/blog/categories/basic/'>basic (2)</a></li>
<li class='category'><a href='/blog/categories/blend/'>blend (1)</a></li>
<li class='category'><a href='/blog/categories/bm-subtract/'>bm_subtract (1)</a></li>
<li class='category'><a href='/blog/categories/box2d/'>box2d (2)</a></li>
<li class='category'><a href='/blog/categories/c-/'>c# (1)</a></li>
<li class='category'><a href='/blog/categories/c-/'>c++ (4)</a></li>
<li class='category'><a href='/blog/categories/ccfileutil/'>ccfileutil (1)</a></li>
<li class='category'><a href='/blog/categories/cocos2d-x/'>cocos2d-x (1)</a></li>
<li class='category'><a href='/blog/categories/cocos2dx/'>cocos2dx (7)</a></li>
<li class='category'><a href='/blog/categories/cocos2dx骨骼动画换装/'>cocos2dx骨骼动画换装 (1)</a></li>
<li class='category'><a href='/blog/categories/djnago-blog-zinnia/'>djnago-blog-zinnia (1)</a></li>
<li class='category'><a href='/blog/categories/dns64/'>dns64 (1)</a></li>
<li class='category'><a href='/blog/categories/facebook/'>facebook (1)</a></li>
<li class='category'><a href='/blog/categories/flavors/'>flavors (1)</a></li>
<li class='category'><a href='/blog/categories/game/'>game (2)</a></li>
<li class='category'><a href='/blog/categories/gdscript/'>gdscript (1)</a></li>
<li class='category'><a href='/blog/categories/git/'>git (5)</a></li>
<li class='category'><a href='/blog/categories/godot/'>godot (1)</a></li>
<li class='category'><a href='/blog/categories/google/'>google (2)</a></li>
<li class='category'><a href='/blog/categories/gradle/'>gradle (1)</a></li>
<li class='category'><a href='/blog/categories/iap/'>iap (1)</a></li>
<li class='category'><a href='/blog/categories/ios/'>ios (2)</a></li>
<li class='category'><a href='/blog/categories/ipv6/'>ipv6 (1)</a></li>
<li class='category'><a href='/blog/categories/java/'>java (1)</a></li>
<li class='category'><a href='/blog/categories/jekins/'>jekins (1)</a></li>
<li class='category'><a href='/blog/categories/jni/'>jni (1)</a></li>
<li class='category'><a href='/blog/categories/keystore/'>keystore (1)</a></li>
<li class='category'><a href='/blog/categories/keytool/'>keytool (1)</a></li>
<li class='category'><a href='/blog/categories/limbo/'>limbo (1)</a></li>
<li class='category'><a href='/blog/categories/linter-luacheck/'>linter-luacheck (1)</a></li>
<li class='category'><a href='/blog/categories/liquidfunc/'>liquidfunc (1)</a></li>
<li class='category'><a href='/blog/categories/log/'>log (1)</a></li>
<li class='category'><a href='/blog/categories/lua/'>lua (9)</a></li>
<li class='category'><a href='/blog/categories/luabing/'>luabing (2)</a></li>
<li class='category'><a href='/blog/categories/luacheck/'>luacheck (1)</a></li>
<li class='category'><a href='/blog/categories/mac/'>mac (2)</a></li>
<li class='category'><a href='/blog/categories/maker/'>maker (2)</a></li>
<li class='category'><a href='/blog/categories/mobile/'>mobile (1)</a></li>
<li class='category'><a href='/blog/categories/mode/'>mode (1)</a></li>
<li class='category'><a href='/blog/categories/obb/'>obb (2)</a></li>
<li class='category'><a href='/blog/categories/opengl/'>opengl (7)</a></li>
<li class='category'><a href='/blog/categories/platform/'>platform (1)</a></li>
<li class='category'><a href='/blog/categories/profiles/'>profiles (2)</a></li>
<li class='category'><a href='/blog/categories/provision/'>provision (2)</a></li>
<li class='category'><a href='/blog/categories/python/'>python (3)</a></li>
<li class='category'><a href='/blog/categories/quaternion/'>quaternion (1)</a></li>
<li class='category'><a href='/blog/categories/rebase/'>rebase (1)</a></li>
<li class='category'><a href='/blog/categories/require/'>require (1)</a></li>
<li class='category'><a href='/blog/categories/restapi/'>restapi (1)</a></li>
<li class='category'><a href='/blog/categories/serpent/'>serpent (1)</a></li>
<li class='category'><a href='/blog/categories/shell/'>shell (1)</a></li>
<li class='category'><a href='/blog/categories/sqlite3/'>sqlite3 (1)</a></li>
<li class='category'><a href='/blog/categories/stickerpack/'>stickerpack (1)</a></li>
<li class='category'><a href='/blog/categories/sublime/'>sublime (1)</a></li>
<li class='category'><a href='/blog/categories/svn/'>svn (1)</a></li>
<li class='category'><a href='/blog/categories/table/'>table (1)</a></li>
<li class='category'><a href='/blog/categories/tolua-/'>tolua++ (1)</a></li>
<li class='category'><a href='/blog/categories/typecho/'>typecho (1)</a></li>
<li class='category'><a href='/blog/categories/unity/'>unity (2)</a></li>
<li class='category'><a href='/blog/categories/unity2d/'>unity2d (1)</a></li>
<li class='category'><a href='/blog/categories/vector3/'>vector3 (1)</a></li>
<li class='category'><a href='/blog/categories/vim/'>vim (1)</a></li>
<li class='category'><a href='/blog/categories/wwdr/'>wwdr (1)</a></li>
<li class='category'><a href='/blog/categories/xcode/'>xcode (1)</a></li>
<li class='category'><a href='/blog/categories/个人网站/'>个人网站 (1)</a></li>
<li class='category'><a href='/blog/categories/人物控制移动/'>人物控制移动 (1)</a></li>
<li class='category'><a href='/blog/categories/冒泡/'>冒泡 (1)</a></li>
<li class='category'><a href='/blog/categories/加密/'>加密 (1)</a></li>
<li class='category'><a href='/blog/categories/动画工具/'>动画工具 (1)</a></li>
<li class='category'><a href='/blog/categories/命令行/'>命令行 (1)</a></li>
<li class='category'><a href='/blog/categories/工作/'>工作 (2)</a></li>
<li class='category'><a href='/blog/categories/快速/'>快速 (1)</a></li>
<li class='category'><a href='/blog/categories/思维发散/'>思维发散 (1)</a></li>
<li class='category'><a href='/blog/categories/总结/'>总结 (1)</a></li>
<li class='category'><a href='/blog/categories/排序/'>排序 (1)</a></li>
<li class='category'><a href='/blog/categories/提交大包/'>提交大包 (1)</a></li>
<li class='category'><a href='/blog/categories/插入/'>插入 (1)</a></li>
<li class='category'><a href='/blog/categories/改进/'>改进 (1)</a></li>
<li class='category'><a href='/blog/categories/效率/'>效率 (1)</a></li>
<li class='category'><a href='/blog/categories/模块化/'>模块化 (1)</a></li>
<li class='category'><a href='/blog/categories/模拟器/'>模拟器 (1)</a></li>
<li class='category'><a href='/blog/categories/游戏/'>游戏 (2)</a></li>
<li class='category'><a href='/blog/categories/游戏引擎/'>游戏引擎 (1)</a></li>
<li class='category'><a href='/blog/categories/游戏测试/'>游戏测试 (1)</a></li>
<li class='category'><a href='/blog/categories/漫威/'>漫威 (1)</a></li>
<li class='category'><a href='/blog/categories/热更/'>热更 (1)</a></li>
<li class='category'><a href='/blog/categories/神秘海域4/'>神秘海域4 (1)</a></li>
<li class='category'><a href='/blog/categories/第三方接入/'>第三方接入 (2)</a></li>
<li class='category'><a href='/blog/categories/算法/'>算法 (1)</a></li>
<li class='category'><a href='/blog/categories/管理总结/'>管理总结 (1)</a></li>
<li class='category'><a href='/blog/categories/管理-沟通/'>管理，沟通 (1)</a></li>
<li class='category'><a href='/blog/categories/胡思乱想/'>胡思乱想 (1)</a></li>
<li class='category'><a href='/blog/categories/脚本/'>脚本 (1)</a></li>
<li class='category'><a href='/blog/categories/自动化/'>自动化 (1)</a></li>
<li class='category'><a href='/blog/categories/自动化测试/'>自动化测试 (1)</a></li>
<li class='category'><a href='/blog/categories/自动更新/'>自动更新 (1)</a></li>
<li class='category'><a href='/blog/categories/苹果审核被拒/'>苹果审核被拒 (1)</a></li>
<li class='category'><a href='/blog/categories/选择/'>选择 (1)</a></li>
<li class='category'><a href='/blog/categories/问题/'>问题 (1)</a></li>
<li class='category'><a href='/blog/categories/项目/'>项目 (2)</a></li>
<li class='category'><a href='/blog/categories/项目管理/'>项目管理 (1)</a></li>
<li class='category'><a href='/blog/categories/顽皮狗/'>顽皮狗 (2)</a></li>

 </ul>
</section>




  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2018 - newtomato -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
