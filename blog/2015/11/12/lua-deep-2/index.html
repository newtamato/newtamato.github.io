
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Lua脚本在C++下的舞步（二） - 番茄手册</title>
  <meta name="author" content="newtomato">

  
  <meta name="description" content="转帖来自：http://www.acejoy.com/bbs/viewthread.php?tid=1931&amp;extra=page%3D1 上一节讲了一些基本的Lua应用，或许你会说，还是很简单么。呵呵，恩，是的，本来Lua就是为了让大家使用的方便快捷而设计的。如果设计的过为复杂， &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://www.newtomato.me/blog/2015/11/12/lua-deep-2">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="番茄手册" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">番茄手册</a></h1>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:www.newtomato.me" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
   <li><a href="/about">About</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Lua脚本在C++下的舞步（二）</h1>
    
    
      <p class="meta">
        








  


<time datetime="2015-11-12T21:47:58+08:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


<div class="entry-content"><p>转帖来自：http://www.acejoy.com/bbs/viewthread.php?tid=1931&amp;extra=page%3D1</p>

<p>上一节讲了一些基本的Lua应用，或许你会说，还是很简单么。呵呵，恩，是的，本来Lua就是为了让大家使用的方便快捷而设计的。如果设计的过为复杂，就不会有人使用了。 <br />
下面，我要强调一下，Lua的栈的一些概念，因为这个确实很重要，你会经常用到。熟练使用Lua，最重要的就是要时刻知道什么时候栈里面的数据是什么顺序，都是什么。如果你能熟练知道这些，实际你已经是Lua运用的高手了。</p>

<!--more-->

<p>说真的，第一次我接触栈的时候，没有把它想的很复杂，倒是看了网上很多的关于Lua的文章让我对栈的理解云里雾里，什么元表，什么User，什么局部变量，什么全局变量位移。说的那叫一个晕。本人脑子笨，理解不了这么多，也不知道为什么很多人喜欢把Lua栈弄的七上八下，代码晦涩难懂。后来实在受不了了，去Lua网站下载了Lua的文档，写的很清晰。Lua的栈实际上几句话足以。 <br />
当你初始化一个栈的时候，它的栈底是1，而栈顶相对位置是-1，说形象一些，你可以把栈想象成一个环，有一个指针标记当前位置，如果-1，就是当前栈顶，如果是-2就是当前栈顶前面一个参数的位置。以此类推。当然，你也可以正序去取，这里要注意，对于Lua的很多API，下标是从1开始的。这个和C++有些不同。而且，在栈的下标中，正数表示绝对栈底的下标，负数表示相对栈顶的相对地址，这个一定要有清晰的概念，否则很容易看晕了。 <br />
让我们看一些例子，加深理解。</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class=""><span class="line">lua_pushnumber(m_pState, 11); 
</span><span class="line">lua_pushnumber(m_pState, 12);
</span><span class="line">int nIn = lua_gettop(m_pState); </span></code></pre></td></tr></table></div></figure></notextile></div>

<p>这里加了一行， lua_gettop()这个API是告诉你目前栈里元素的个数。 <br />
如果仅仅是Push两个参数，那么nIn的数值是2，对。没错。那么咱们看看栈里面是怎么放的。我再加两行代码。</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class=""><span class="line">int nData1 = lua_tonumber(m_pState, 1);     //读取栈底第一个绝对坐标中的元素 
</span><span class="line">int nData2 = lua_tonumber(m_pState, 2);     //读取栈底第二个绝对坐标中的元素 
</span><span class="line">printf(“[Test]nData1  = %d, nData2  = %d./n”); </span></code></pre></td></tr></table></div></figure></notextile></div>

<p>如果是你，凭直觉，告诉我答案是什么？ <br />
现在公布答案，看看是不是和你想的一样。 <br />
[Test]nData1  = 11, nData2  = 12</p>

<p>呵呵，那么，如果我把代码换成</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
</pre></td><td class="code"><pre><code class=""><span class="line">lua_pushnumber(m_pState, 11); 
</span><span class="line">lua_pushnumber(m_pState, 12);
</span><span class="line">
</span><span class="line">int nIn = lua_gettop(m_pState)
</span><span class="line">
</span><span class="line">int nData1 = lua_tonumber(m_pState, -1);     &lt;–读取栈顶第一个相对坐标中的元素 
</span><span class="line">int nData2 = lua_tonumber(m_pState, -2);     &lt;–读取栈顶第二个相对坐标中的元素 
</span><span class="line">printf(“[Test]nData1  = %d, nData2  = %d./n”);</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>请你告诉我输出是什么？ <br />
答案是 <br />
[Test]nData1  = 12, nData2  = 11</p>

<p>呵呵，挺简单的吧，对了，其实就这么简单。网上其它的高阶运用，其实大部分都是对栈的位置进行调整。只要你抓住主要概念，看懂还是不难的。什么元表，什么变量，其实都一样，抓住核心，时刻知道栈里面的样子，就没有问题。 <br />
好了，回到我上一节的那个代码。</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
<span class="line-number">30</span>
<span class="line-number">31</span>
<span class="line-number">32</span>
<span class="line-number">33</span>
</pre></td><td class="code"><pre><code class=""><span class="line">bool CLuaFn::CallFileFn(const char* pFunctionName, int nParam1, int nParam2) 
</span><span class="line">{ 
</span><span class="line">        int nRet = 0; 
</span><span class="line">        if(NULL == m_pState) 
</span><span class="line">        { 
</span><span class="line">                printf(“[CLuaFn::CallFileFn]m_pState is NULL./n”); 
</span><span class="line">                return false; 
</span><span class="line">        }
</span><span class="line">
</span><span class="line">        lua_getglobal(m_pState, pFunctionName);
</span><span class="line">
</span><span class="line">        lua_pushnumber(m_pState, nParam1); 
</span><span class="line">        lua_pushnumber(m_pState, nParam2);
</span><span class="line">
</span><span class="line">        int nIn = lua_gettop(m_pState); &lt;–在这里加一行。
</span><span class="line">
</span><span class="line">        nRet = lua_pcall(m_pState, 2, 1, 0); 
</span><span class="line">        if (nRet != 0) 
</span><span class="line">        { 
</span><span class="line">                printf(“[CLuaFn::CallFileFn]call function(%s) error(%d)./n”, pFunctionName, nRet); 
</span><span class="line">                return false; 
</span><span class="line">        }
</span><span class="line">
</span><span class="line">        if (lua_isnumber(m_pState, -1) == 1) 
</span><span class="line">        { 
</span><span class="line">                int nSum = lua_tonumber(m_pState, -1); 
</span><span class="line">                printf(“[CLuaFn::CallFileFn]Sum = %d./n”, nSum); 
</span><span class="line">        }
</span><span class="line">
</span><span class="line">        int nOut = lua_gettop(m_pState); &lt;–在这里加一行。
</span><span class="line">
</span><span class="line">        return true; 
</span><span class="line">}</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>nIn的答案是多少？或许你会说是2吧，呵呵，实际是3。或许你会问，为什么会多一个？其实我第一次看到这个数字，也很诧异。但是确实是3。因为你调用的函数名称占据了一个堆栈的位置。其实，在获取nIn那一刻，堆栈的样子是这样的（函数接口地址，参数1，参数2），函数名称也是一个变量入栈的。而nOut输出是1，lua_pcall()函数在调用成功之后，会自动的清空栈，然后把结果放入栈中。在获取nOut的一刻，栈内是这幅摸样(输出参数1)。</p>

<p>这里就要再迁出一个更重要的概念了，Lua不是C++，对于C++程序员而言，一个函数会自动创建栈，当函数执行完毕后会自动清理栈，Lua可不会给你这么做，对于Lua而言，它没有函数这个概念，一个栈对应一个lua_State指针，也就是说，你必须手动去清理你不用的栈，否则会造成垃圾数据占据你的内存。</p>

<p>不信？那么咱们来验证一下，就拿昨天的代码吧，你用for循环调用100万次。看看nOut的输出结果。。我相信，程序执行不到100万次就会崩溃，而你的内存也会变的硕大无比。而nOut的输出也会是这样的 1,2,3,4,5,6。。。。。 <br />
原因就是，Lua不会清除你以前栈内的数据，每调用一次都会给你生成一个新的栈元素插入其中。 <br />
那么怎么解决呢？呵呵，其实，如果不考虑多线程的话，在你的函数最后退出前加一句话，就可以轻松解决这个问题。(Lua栈操作是非线程安全的！)</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class=""><span class="line">lua_settop(m_pState, -2); </span></code></pre></td></tr></table></div></figure></notextile></div>

<p>这句话的意思是什么？lua_settop()是设置栈顶的位置，我这么写，意思就是，栈顶指针目前在当前位置的-2的元素上。这样，我就实现了对栈的清除。仔细想一下，是不是这个道理呢？</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
<span class="line-number">30</span>
<span class="line-number">31</span>
<span class="line-number">32</span>
<span class="line-number">33</span>
<span class="line-number">34</span>
</pre></td><td class="code"><pre><code class=""><span class="line">bool CLuaFn::CallFileFn(const char* pFunctionName, int nParam1, int nParam2) 
</span><span class="line">{ 
</span><span class="line">        int nRet = 0; 
</span><span class="line">        if(NULL == m_pState) 
</span><span class="line">        { 
</span><span class="line">                printf(“[CLuaFn::CallFileFn]m_pState is NULL./n”); 
</span><span class="line">                return false; 
</span><span class="line">        }
</span><span class="line">
</span><span class="line">        lua_getglobal(m_pState, pFunctionName);
</span><span class="line">
</span><span class="line">        lua_pushnumber(m_pState, nParam1); 
</span><span class="line">        lua_pushnumber(m_pState, nParam2);
</span><span class="line">
</span><span class="line">        int nIn = lua_gettop(m_pState); &lt;–在这里加一行。
</span><span class="line">
</span><span class="line">        nRet = lua_pcall(m_pState, 2, 1, 0); 
</span><span class="line">        if (nRet != 0) 
</span><span class="line">        { 
</span><span class="line">                printf(“[CLuaFn::CallFileFn]call function(%s) error(%d)./n”, pFunctionName, nRet); 
</span><span class="line">                return false; 
</span><span class="line">        }
</span><span class="line">
</span><span class="line">        if (lua_isnumber(m_pState, -1) == 1) 
</span><span class="line">        { 
</span><span class="line">                int nSum = lua_tonumber(m_pState, -1); 
</span><span class="line">                printf(“[CLuaFn::CallFileFn]Sum = %d./n”, nSum); 
</span><span class="line">        }
</span><span class="line">
</span><span class="line">        int nOut = lua_gettop(m_pState); &lt;–在这里加一行。 
</span><span class="line">        lua_settop(m_pState, -2);             &lt;–清除不用的栈。
</span><span class="line">
</span><span class="line">        return true; 
</span><span class="line">}</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>好了，再让我们运行100万次，看看你的程序内存，看看你的程序还崩溃不？ <br />
如果你想打印 nOut的话，输出会变成1,1,1,1,1。。。。 <br />
最后说一句，lua_tonumber()或lua_tostring()还有以后我们要用到的lua_touserdata()一定要将数据完全取出后保存到你的别的变量中去，否则会因为清栈操作，导致你的程序异常，切记！</p>

<p>呵呵，说了这么多，主要是让大家如何写一个严谨的Lua程序，不要运行没两下就崩溃了。好了，基础栈的知识先说到这里，以后还有一些技巧的运用，到时候会给大家展示。</p>

<p>下面说一下，Lua的工具。（为什么要说这个呢？呵呵，因为我们下一步要用到其中的一个帮助我们的开发。） <br />
呵呵，其实，Lua里面有很多简化开发的工具，你可以去http://www.sourceforge.net/去找一下。它们能够帮助你简化C++对象与Lua对象互转之间的代码。 <br />
这里说几个有名的，当然可能不全。</p>

<blockquote>
  <p>(lua tinker)如果你的系统在windows下，而且不考虑移植，那么我强烈推荐你去下载一个叫做lua tinker的小工具，整个工具非常简单，一个.h和一个.cpp。直接就可以引用到你的工程中，连独立编译都不用，这是一个韩国人写的Lua与 C++接口转换的类，十分方便，代码简洁（居家旅行，必备良药）。它是基于模板的，所以你可以很轻松的把你的C++对象绑定到Lua中。代码较长，呵呵，有兴趣的朋友可以给我留言索要lua tinker的例子。就不贴在这里了。不过我个人不推荐这个东西，因为它在Linux下是编译不过去的。它使用了一种g++不支持的模板写法，虽然有人在尝试把它修改到Linux下编译，但据我所知，修改后效果较好的似乎还没有。不过如果你只是在  windows下，那就没什么可犹豫的，强烈推荐，你会喜欢它的。</p>
</blockquote>

<blockquote>
  <p>(Luabinder)相信用过Boost库的朋友，或许对这个家伙很熟悉。它是一个很强大的Linux下Lua扩展包，帮你封装了很多Lua的复杂操作，主要解决了绑定C++对象和Lua对象互动的关系，非常强大，不过嘛，对于freeeyes而言，还是不推荐，因为freeeyes很懒，不想为了一个Lua还要去编译一个庞大的boost库，当然，见仁见智，如果你的程序本身就已经加载了boost，那么就应该毫不犹豫的选择它。</p>
</blockquote>

<blockquote>
  <p>(lua++)呵呵，这是我最喜欢，也是我一直用到现在的库，比较前两个而言，lua++的封装性没有那么好，很多东西还是需要一点代码的，不过之所以我喜欢，是因为它是用C写的，可以在windows下和linux下轻松转换。如果鱼与熊掌不能兼得，那么我宁愿选择一个兼顾两者的东西，如果有的话，呵呵。当然，lua++就是这么一个东西，如果你继续看我的文章，或许你也会喜欢它的。</p>
</blockquote>

<p>好了，废话少说，就让我选择lua++作为我们继续进行下去的垫脚石吧。 <br />
说到<a href="http://www.codenix.com/~tolua/">Lua++</a>，这个东西还是挺有渊源的，请你先下载一个。我教你怎么编译。</p>

<p>还记得我昨天说过如何编译Lua么，现在请你再做一遍，不同的是，请把lua++的程序包中的src/lib中的所有h和cpp，还有include下的那个.h拷贝到你上次建立的lua工程中。然后全部添加到你的静态链接库工程中去，重新编译。会生成一个新的lua.lib，这个lua就自动包含了lua++的功能。最后记得把tolua++.h放在你的Include文件夹下。 <br />
行了，我们把上次CLuaFn类稍微改一下。</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
</pre></td><td class="code"><pre><code class=""><span class="line">extern “C” 
</span><span class="line">{ 
</span><span class="line">        #include “lua.h” 
</span><span class="line">        #include “lualib.h” 
</span><span class="line">        #include “lauxlib.h” 
</span><span class="line">        #include “tolua++”   //这里加一行 
</span><span class="line">};
</span><span class="line">
</span><span class="line">class CLuaFn 
</span><span class="line">{ 
</span><span class="line">public: 
</span><span class="line">        CLuaFn(void); 
</span><span class="line">        ~CLuaFn(void);
</span><span class="line">
</span><span class="line">        void Init();            //初始化Lua对象指针参数 
</span><span class="line">        void Close();         //关闭Lua对象指针
</span><span class="line">		//加载指定的Lua文件 
</span><span class="line">        bool LoadLuaFile(const char* pFileName);                              
</span><span class="line">        //执行指定Lua文件中的函数
</span><span class="line">        bool CallFileFn(const char* pFunctionName, int nParam1, int nParam2);        
</span><span class="line">private: 
</span><span class="line">        lua_State* m_pState;   //这个是Lua的State对象指针，你可以一个lua文件对应一个。 
</span><span class="line">};</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>行了，这样我们就能用Lua++下的功能了。</p>

<p>昨天，大家看到了 bool CallFileFn(const char* pFunctionName, int nParam1, int nParam2);这个函数的运用。演示了怎么调用Lua函数。 <br />
下面，我改一下，这个函数。为什么？还是因为freeeyes很懒，我可不想每有一个函数，我都要写一个C++函数去调用，太累！我要写一个通用的！支持任意函数调用的接口！ <br />
于是我创建了两个类。支持任意参数的输入和输出，并打包送给lua去执行，说干就干。</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
<span class="line-number">30</span>
<span class="line-number">31</span>
<span class="line-number">32</span>
<span class="line-number">33</span>
<span class="line-number">34</span>
<span class="line-number">35</span>
<span class="line-number">36</span>
<span class="line-number">37</span>
<span class="line-number">38</span>
<span class="line-number">39</span>
<span class="line-number">40</span>
<span class="line-number">41</span>
<span class="line-number">42</span>
<span class="line-number">43</span>
<span class="line-number">44</span>
<span class="line-number">45</span>
<span class="line-number">46</span>
<span class="line-number">47</span>
<span class="line-number">48</span>
<span class="line-number">49</span>
<span class="line-number">50</span>
<span class="line-number">51</span>
<span class="line-number">52</span>
<span class="line-number">53</span>
<span class="line-number">54</span>
<span class="line-number">55</span>
<span class="line-number">56</span>
<span class="line-number">57</span>
<span class="line-number">58</span>
<span class="line-number">59</span>
<span class="line-number">60</span>
<span class="line-number">61</span>
<span class="line-number">62</span>
<span class="line-number">63</span>
<span class="line-number">64</span>
<span class="line-number">65</span>
<span class="line-number">66</span>
<span class="line-number">67</span>
<span class="line-number">68</span>
<span class="line-number">69</span>
<span class="line-number">70</span>
<span class="line-number">71</span>
<span class="line-number">72</span>
<span class="line-number">73</span>
<span class="line-number">74</span>
<span class="line-number">75</span>
<span class="line-number">76</span>
<span class="line-number">77</span>
<span class="line-number">78</span>
<span class="line-number">79</span>
<span class="line-number">80</span>
<span class="line-number">81</span>
<span class="line-number">82</span>
<span class="line-number">83</span>
<span class="line-number">84</span>
<span class="line-number">85</span>
<span class="line-number">86</span>
<span class="line-number">87</span>
<span class="line-number">88</span>
<span class="line-number">89</span>
<span class="line-number">90</span>
<span class="line-number">91</span>
<span class="line-number">92</span>
<span class="line-number">93</span>
<span class="line-number">94</span>
<span class="line-number">95</span>
<span class="line-number">96</span>
<span class="line-number">97</span>
<span class="line-number">98</span>
<span class="line-number">99</span>
<span class="line-number">100</span>
<span class="line-number">101</span>
<span class="line-number">102</span>
<span class="line-number">103</span>
<span class="line-number">104</span>
<span class="line-number">105</span>
<span class="line-number">106</span>
<span class="line-number">107</span>
<span class="line-number">108</span>
<span class="line-number">109</span>
<span class="line-number">110</span>
<span class="line-number">111</span>
<span class="line-number">112</span>
<span class="line-number">113</span>
<span class="line-number">114</span>
<span class="line-number">115</span>
<span class="line-number">116</span>
<span class="line-number">117</span>
<span class="line-number">118</span>
<span class="line-number">119</span>
<span class="line-number">120</span>
<span class="line-number">121</span>
<span class="line-number">122</span>
<span class="line-number">123</span>
<span class="line-number">124</span>
<span class="line-number">125</span>
<span class="line-number">126</span>
<span class="line-number">127</span>
<span class="line-number">128</span>
<span class="line-number">129</span>
<span class="line-number">130</span>
<span class="line-number">131</span>
<span class="line-number">132</span>
<span class="line-number">133</span>
<span class="line-number">134</span>
<span class="line-number">135</span>
<span class="line-number">136</span>
</pre></td><td class="code"><pre><code class=""><span class="line">#ifndef _PARAMDATA_H 
</span><span class="line">#define _PARAMDATA_H
</span><span class="line">
</span><span class="line">#include &lt;vector&gt;
</span><span class="line">
</span><span class="line">#define MAX_PARAM_200 200
</span><span class="line">
</span><span class="line">using namespace std;
</span><span class="line">
</span><span class="line">struct _ParamData 
</span><span class="line">{ 
</span><span class="line">public: 
</span><span class="line">        void* m_pParam; 
</span><span class="line">        char  m_szType[MAX_PARAM_200]; 
</span><span class="line">        int   m_TypeLen;
</span><span class="line">
</span><span class="line">public: 
</span><span class="line">        _ParamData() 
</span><span class="line">        { 
</span><span class="line">                m_pParam    = NULL; 
</span><span class="line">                m_szType[0] = ‘/0′; 
</span><span class="line">                m_TypeLen   = 0; 
</span><span class="line">        };
</span><span class="line">
</span><span class="line">        _ParamData(void* pParam, const char* szType, int nTypeLen) 
</span><span class="line">        { 
</span><span class="line">                SetParam(pParam, szType, nTypeLen); 
</span><span class="line">        }
</span><span class="line">
</span><span class="line">        ~_ParamData() {};
</span><span class="line">
</span><span class="line">        void SetParam(void* pParam, const char* szType, int nTypeLen) 
</span><span class="line">        { 
</span><span class="line">                m_pParam = pParam; 
</span><span class="line">                sprintf(m_szType, “%s”, szType); 
</span><span class="line">                m_TypeLen = nTypeLen; 
</span><span class="line">        };
</span><span class="line">
</span><span class="line">        bool SetData(void* pParam, int nLen) 
</span><span class="line">        { 
</span><span class="line">                if(m_TypeLen &lt; nLen) 
</span><span class="line">                { 
</span><span class="line">                        return false; 
</span><span class="line">                }
</span><span class="line">
</span><span class="line">                if(nLen &gt; 0) 
</span><span class="line">                { 
</span><span class="line">                        memcpy(m_pParam, pParam, nLen); 
</span><span class="line">                } 
</span><span class="line">                else 
</span><span class="line">                { 
</span><span class="line">                        memcpy(m_pParam, pParam, m_TypeLen); 
</span><span class="line">                } 
</span><span class="line">                return true; 
</span><span class="line">        }
</span><span class="line">
</span><span class="line">        void* GetParam() 
</span><span class="line">        { 
</span><span class="line">                return m_pParam; 
</span><span class="line">        }
</span><span class="line">
</span><span class="line">        const char* GetType() 
</span><span class="line">        { 
</span><span class="line">                return m_szType; 
</span><span class="line">        }
</span><span class="line">
</span><span class="line">        bool CompareType(const char* pType) 
</span><span class="line">        { 
</span><span class="line">                if(0 == strcmp(m_szType, pType)) 
</span><span class="line">                { 
</span><span class="line">                        return true; 
</span><span class="line">                } 
</span><span class="line">                else 
</span><span class="line">                { 
</span><span class="line">                        return false; 
</span><span class="line">                } 
</span><span class="line">        } 
</span><span class="line">};
</span><span class="line">
</span><span class="line">class CParamGroup 
</span><span class="line">{ 
</span><span class="line">public: 
</span><span class="line">        CParamGroup() {}; 
</span><span class="line">        ~CParamGroup() 
</span><span class="line">        { 
</span><span class="line">                Close(); 
</span><span class="line">        };
</span><span class="line">
</span><span class="line">        void Init() 
</span><span class="line">        { 
</span><span class="line">                m_vecParamData.clear(); 
</span><span class="line">        };
</span><span class="line">
</span><span class="line">        void Close() 
</span><span class="line">        { 
</span><span class="line">                for(int i = 0; i &lt; (int)m_vecParamData.size(); i++) 
</span><span class="line">                { 
</span><span class="line">                        _ParamData* pParamData = m_vecParamData; 
</span><span class="line">                        delete pParamData; 
</span><span class="line">                        pParamData = NULL; 
</span><span class="line">                } 
</span><span class="line">                m_vecParamData.clear(); 
</span><span class="line">        };
</span><span class="line">
</span><span class="line">        void Push(_ParamData* pParam) 
</span><span class="line">        { 
</span><span class="line">                if(pParam != NULL) 
</span><span class="line">                { 
</span><span class="line">                        m_vecParamData.push_back(pParam); 
</span><span class="line">                } 
</span><span class="line">        };
</span><span class="line">
</span><span class="line">        _ParamData* GetParam(int nIndex) 
</span><span class="line">        { 
</span><span class="line">                if(nIndex &lt; (int)m_vecParamData.size()) 
</span><span class="line">                { 
</span><span class="line">                        return m_vecParamData[nIndex]; 
</span><span class="line">                } 
</span><span class="line">                else 
</span><span class="line">                { 
</span><span class="line">                        return NULL; 
</span><span class="line">                } 
</span><span class="line">        };
</span><span class="line">
</span><span class="line">        int GetCount() 
</span><span class="line">        { 
</span><span class="line">                return (int)m_vecParamData.size(); 
</span><span class="line">        }
</span><span class="line">
</span><span class="line">private: 
</span><span class="line">        typedef vector&lt;_ParamData*&gt; vecParamData; 
</span><span class="line">        vecParamData m_vecParamData; 
</span><span class="line">};
</span><span class="line">
</span><span class="line">#endif
</span><span class="line">#endif</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>我创建了两个类，把Lua要用到的类型，数据都封装起来了。这样，我只需要这么改写这个函数。 <br />
bool CallFileFn(const char* pFunctionName, CParamGroup&amp; ParamIn, CParamGroup&amp; ParamOut); <br />
它就能按照不同的参数自动给我调用，嘿嘿，懒到家吧！ <br />
其实这两个类很简单，_ParamData是参数类，把你要用到的参数放入到这个对象中去，标明类型的大小，类型名称，内存块。而CParamGroup负责将很多很多的_ParamData打包在一起，放在vector里面。</p>

<p>好了，让我们看看CallFileFn函数里面我怎么改的。</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
<span class="line-number">30</span>
<span class="line-number">31</span>
<span class="line-number">32</span>
<span class="line-number">33</span>
<span class="line-number">34</span>
<span class="line-number">35</span>
<span class="line-number">36</span>
<span class="line-number">37</span>
<span class="line-number">38</span>
</pre></td><td class="code"><pre><code class=""><span class="line">bool CLuaFn::CallFileFn(const char* pFunctionName, CParamGroup&amp; ParamIn, CParamGroup&amp; ParamOut) 
</span><span class="line">{ 
</span><span class="line">        int nRet = 0; 
</span><span class="line">        int i    = 0; 
</span><span class="line">        if(NULL == m_pState) 
</span><span class="line">        { 
</span><span class="line">                printf(“[CLuaFn::CallFileFn]m_pState is NULL./n”); 
</span><span class="line">                return false; 
</span><span class="line">        }
</span><span class="line">
</span><span class="line">        lua_getglobal(m_pState, pFunctionName);
</span><span class="line">
</span><span class="line">        //加载输入参数 
</span><span class="line">        for(i = 0; i &lt; ParamIn.GetCount(); i++) 
</span><span class="line">        { 
</span><span class="line">                PushLuaData(m_pState, ParamIn.GetParam(i)); 
</span><span class="line">        }
</span><span class="line">
</span><span class="line">        nRet = lua_pcall(m_pState, ParamIn.GetCount(), ParamOut.GetCount(), 0); 
</span><span class="line">        if (nRet != 0) 
</span><span class="line">        { 
</span><span class="line">                printf(“[CLuaFn::CallFileFn]call function(%s) error(%s)./n”, pFunctionName, lua_tostring(m_pState, -1)); 
</span><span class="line">                return false; 
</span><span class="line">        }
</span><span class="line">
</span><span class="line">        //获得输出参数 
</span><span class="line">        int nPos = 0; 
</span><span class="line">        for(i = ParamOut.GetCount() – 1; i &gt;= 0; i–) 
</span><span class="line">        { 
</span><span class="line">                nPos–; 
</span><span class="line">                PopLuaData(m_pState, ParamOut.GetParam(i), nPos); 
</span><span class="line">        }
</span><span class="line">
</span><span class="line">        int nCount = lua_gettop(m_pState); 
</span><span class="line">        lua_settop(m_pState, -1-ParamOut.GetCount());
</span><span class="line">
</span><span class="line">        return true; 
</span><span class="line">}</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>呵呵，别的没变，加了两个循环，因为考虑lua是可以支持多结果返回的，所以我也做了一个循环接受参数。 <br />
lua_settop(m_pState, -1-ParamOut.GetCount());这句话是不是有些意思，恩，是的，我这里做了一个小技巧，因为我不知道返回参数有几个，所以我会根据返回参数的个数重新设置栈顶。这样做可以返回任意数量的栈而且清除干净。 <br />
或许细心的你已经发现，里面多了两个函数。恩，是的。来看看这两个函数在干什么。</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
</pre></td><td class="code"><pre><code class=""><span class="line">bool CLuaFn::PushLuaData(lua_State* pState, _ParamData* pParam) 
</span><span class="line">{ 
</span><span class="line">        if(pParam == NULL) 
</span><span class="line">        { 
</span><span class="line">                return false; 
</span><span class="line">        }
</span><span class="line">
</span><span class="line">        if(pParam-&gt;CompareType(“string”)) 
</span><span class="line">        { 
</span><span class="line">                lua_pushstring(m_pState, (char* )pParam-&gt;GetParam()); 
</span><span class="line">                return true; 
</span><span class="line">        }
</span><span class="line">
</span><span class="line">        if(pParam-&gt;CompareType(“int”)) 
</span><span class="line">        { 
</span><span class="line">                int* nData = (int* )pParam-&gt;GetParam(); 
</span><span class="line">                lua_pushnumber(m_pState, *nData); 
</span><span class="line">                return true; 
</span><span class="line">        } 
</span><span class="line">        else 
</span><span class="line">        { 
</span><span class="line">                void* pVoid = pParam-&gt;GetParam(); 
</span><span class="line">                tolua_pushusertype(m_pState, pVoid, pParam-&gt;GetType()); 
</span><span class="line">                return true; 
</span><span class="line">        } 
</span><span class="line">}</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>参数入栈操作，呵呵，或许你会问tolua_pushusertype(m_pState, pVoid, pParam-&gt;GetType());这句话，你可能有些看不懂，没关系，我会在下一讲详细的解释Lua++的一些API的用法。现在大概和你说一下，这句话的意思就是，把一个C++对象传输给Lua函数。 <br />
再看看，下面一个。</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
<span class="line-number">30</span>
<span class="line-number">31</span>
<span class="line-number">32</span>
</pre></td><td class="code"><pre><code class=""><span class="line">bool CLuaFn:: PopLuaData(lua_State* pState, _ParamData* pParam, int nIndex) 
</span><span class="line">{ 
</span><span class="line">        if(pParam == NULL) 
</span><span class="line">        { 
</span><span class="line">                return false; 
</span><span class="line">        }
</span><span class="line">
</span><span class="line">        if(pParam-&gt;CompareType(“string”)) 
</span><span class="line">        { 
</span><span class="line">                if (lua_isstring(m_pState, nIndex) == 1) 
</span><span class="line">                { 
</span><span class="line">                        const char* pData = (const char*)lua_tostring(m_pState, nIndex); 
</span><span class="line">                        pParam-&gt;SetData((void* )pData, (int)strlen(pData)); 
</span><span class="line">                } 
</span><span class="line">                return true; 
</span><span class="line">        }
</span><span class="line">
</span><span class="line">        if(pParam-&gt;CompareType(“int”)) 
</span><span class="line">        { 
</span><span class="line">                if (lua_isnumber(m_pState, nIndex) == 1) 
</span><span class="line">                { 
</span><span class="line">                        int nData = (int)lua_tonumber(m_pState, nIndex); 
</span><span class="line">                        pParam-&gt;SetData(&amp;nData, sizeof(int)); 
</span><span class="line">                } 
</span><span class="line">                return true; 
</span><span class="line">        } 
</span><span class="line">        else 
</span><span class="line">        { 
</span><span class="line">                pParam-&gt;SetData(tolua_tousertype(m_pState, nIndex, NULL), -1); 
</span><span class="line">                return true; 
</span><span class="line">        } 
</span><span class="line">}</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>弹出一个参数并赋值。pParam-&gt;SetData(tolua_tousertype(m_pState, nIndex, NULL), -1);这句话同样，我在下一讲中详细介绍。 <br />
呵呵，好了，我们又进了一步，我们可以用这个函数绑定任意一个Lua函数格式。而代码不用多写，懒蛋的目的达到了。 <br />
呵呵，这一讲主要是介绍了一些基本知识，或许有点多余，但是我觉得是必要的，在下一讲中，我讲开始详细介绍如何绑定一个C++对象给Lua，并让Lua对其修改。然后返回结果。休息一下，休息一下先。</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">newtomato</span></span>

      








  


<time datetime="2015-11-12T21:47:58+08:00" pubdate data-updated="true"></time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/c-plus-plus/'>c++</a>, <a class='category' href='/blog/categories/lua/'>lua</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://www.newtomato.me/blog/2015/11/12/lua-deep-2" data-via="" data-counturl="http://www.newtomato.me/blog/2015/11/12/lua-deep-2" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2015/11/12/lua-deep" title="Previous Post: Lua脚本在C++下的舞步(入门指引)（转）">&laquo; Lua脚本在C++下的舞步(入门指引)（转）</a>
      
      
        <a class="basic-alignment right" href="/blog/2015/11/12/lua-deep-3" title="Next Post: Lua脚本在C++下的舞步（三）">Lua脚本在C++下的舞步（三） &raquo;</a>
      
    </p>
  </footer>
</article>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2017/05/23/shi-yong-godot">使用GoDot引擎制作一款mini小游戏</a>
      </li>
    
      <li class="post">
        <a href="/blog/2017/05/14/unity-uguikong-jian">Unity UGUI控件</a>
      </li>
    
      <li class="post">
        <a href="/blog/2017/05/14/kong-zhi-jing-tou-gen-sui">怎么控制镜头跟随人物移动</a>
      </li>
    
      <li class="post">
        <a href="/blog/2017/04/15/requirehe-re-geng">require机制和自动更新之间的爱恨情仇</a>
      </li>
    
      <li class="post">
        <a href="/blog/2017/03/12/ji-zui-jin-yu-dao-zui-tou-teng-de-bug">记最近遇到最头疼的一个Bug</a>
      </li>
    
  </ul>
</section>
<section>
 <h1>Categories</h1>
 <ul id="categories">
  <li class='category'><a href='/blog/categories/2d/'>2d (1)</a></li>
<li class='category'><a href='/blog/categories/ads/'>ads (1)</a></li>
<li class='category'><a href='/blog/categories/android/'>android (5)</a></li>
<li class='category'><a href='/blog/categories/androidstudio/'>androidstudio (1)</a></li>
<li class='category'><a href='/blog/categories/android开发/'>android开发 (1)</a></li>
<li class='category'><a href='/blog/categories/apache/'>apache (1)</a></li>
<li class='category'><a href='/blog/categories/apk/'>apk (1)</a></li>
<li class='category'><a href='/blog/categories/basic/'>basic (2)</a></li>
<li class='category'><a href='/blog/categories/c-/'>c++ (4)</a></li>
<li class='category'><a href='/blog/categories/ccfileutil/'>ccfileutil (1)</a></li>
<li class='category'><a href='/blog/categories/cocos2d-x/'>cocos2d-x (1)</a></li>
<li class='category'><a href='/blog/categories/cocos2dx/'>cocos2dx (3)</a></li>
<li class='category'><a href='/blog/categories/cocos2dx骨骼动画换装/'>cocos2dx骨骼动画换装 (1)</a></li>
<li class='category'><a href='/blog/categories/dns64/'>dns64 (1)</a></li>
<li class='category'><a href='/blog/categories/facebook/'>facebook (1)</a></li>
<li class='category'><a href='/blog/categories/flavors/'>flavors (1)</a></li>
<li class='category'><a href='/blog/categories/gdscript/'>gdscript (1)</a></li>
<li class='category'><a href='/blog/categories/git/'>git (4)</a></li>
<li class='category'><a href='/blog/categories/godot/'>godot (1)</a></li>
<li class='category'><a href='/blog/categories/google/'>google (2)</a></li>
<li class='category'><a href='/blog/categories/iap/'>iap (1)</a></li>
<li class='category'><a href='/blog/categories/ios/'>ios (2)</a></li>
<li class='category'><a href='/blog/categories/ipv6/'>ipv6 (1)</a></li>
<li class='category'><a href='/blog/categories/java/'>java (1)</a></li>
<li class='category'><a href='/blog/categories/jni/'>jni (1)</a></li>
<li class='category'><a href='/blog/categories/keystore/'>keystore (1)</a></li>
<li class='category'><a href='/blog/categories/keytool/'>keytool (1)</a></li>
<li class='category'><a href='/blog/categories/limbo/'>limbo (1)</a></li>
<li class='category'><a href='/blog/categories/log/'>log (1)</a></li>
<li class='category'><a href='/blog/categories/lua/'>lua (9)</a></li>
<li class='category'><a href='/blog/categories/mac/'>mac (1)</a></li>
<li class='category'><a href='/blog/categories/mobile/'>mobile (1)</a></li>
<li class='category'><a href='/blog/categories/obb/'>obb (2)</a></li>
<li class='category'><a href='/blog/categories/profiles/'>profiles (2)</a></li>
<li class='category'><a href='/blog/categories/provision/'>provision (2)</a></li>
<li class='category'><a href='/blog/categories/python/'>python (2)</a></li>
<li class='category'><a href='/blog/categories/quaternion/'>quaternion (1)</a></li>
<li class='category'><a href='/blog/categories/rebase/'>rebase (1)</a></li>
<li class='category'><a href='/blog/categories/require/'>require (1)</a></li>
<li class='category'><a href='/blog/categories/restapi/'>restapi (1)</a></li>
<li class='category'><a href='/blog/categories/serpent/'>serpent (1)</a></li>
<li class='category'><a href='/blog/categories/shell/'>shell (1)</a></li>
<li class='category'><a href='/blog/categories/sqlite3/'>sqlite3 (1)</a></li>
<li class='category'><a href='/blog/categories/stickerpack/'>stickerpack (1)</a></li>
<li class='category'><a href='/blog/categories/table/'>table (1)</a></li>
<li class='category'><a href='/blog/categories/typecho/'>typecho (1)</a></li>
<li class='category'><a href='/blog/categories/unity/'>unity (1)</a></li>
<li class='category'><a href='/blog/categories/vector3/'>vector3 (1)</a></li>
<li class='category'><a href='/blog/categories/vim/'>vim (1)</a></li>
<li class='category'><a href='/blog/categories/wwdr/'>wwdr (1)</a></li>
<li class='category'><a href='/blog/categories/xcode/'>xcode (1)</a></li>
<li class='category'><a href='/blog/categories/个人网站/'>个人网站 (1)</a></li>
<li class='category'><a href='/blog/categories/人物控制移动/'>人物控制移动 (1)</a></li>
<li class='category'><a href='/blog/categories/冒泡/'>冒泡 (1)</a></li>
<li class='category'><a href='/blog/categories/加密/'>加密 (1)</a></li>
<li class='category'><a href='/blog/categories/动画工具/'>动画工具 (1)</a></li>
<li class='category'><a href='/blog/categories/命令行/'>命令行 (1)</a></li>
<li class='category'><a href='/blog/categories/工作/'>工作 (2)</a></li>
<li class='category'><a href='/blog/categories/快速/'>快速 (1)</a></li>
<li class='category'><a href='/blog/categories/思维发散/'>思维发散 (1)</a></li>
<li class='category'><a href='/blog/categories/总结/'>总结 (1)</a></li>
<li class='category'><a href='/blog/categories/排序/'>排序 (1)</a></li>
<li class='category'><a href='/blog/categories/提交大包/'>提交大包 (1)</a></li>
<li class='category'><a href='/blog/categories/插入/'>插入 (1)</a></li>
<li class='category'><a href='/blog/categories/改进/'>改进 (1)</a></li>
<li class='category'><a href='/blog/categories/效率/'>效率 (1)</a></li>
<li class='category'><a href='/blog/categories/模块化/'>模块化 (1)</a></li>
<li class='category'><a href='/blog/categories/模拟器/'>模拟器 (1)</a></li>
<li class='category'><a href='/blog/categories/游戏/'>游戏 (1)</a></li>
<li class='category'><a href='/blog/categories/游戏引擎/'>游戏引擎 (1)</a></li>
<li class='category'><a href='/blog/categories/游戏测试/'>游戏测试 (1)</a></li>
<li class='category'><a href='/blog/categories/漫威/'>漫威 (1)</a></li>
<li class='category'><a href='/blog/categories/热更/'>热更 (1)</a></li>
<li class='category'><a href='/blog/categories/神秘海域4/'>神秘海域4 (1)</a></li>
<li class='category'><a href='/blog/categories/第三方接入/'>第三方接入 (2)</a></li>
<li class='category'><a href='/blog/categories/算法/'>算法 (1)</a></li>
<li class='category'><a href='/blog/categories/管理总结/'>管理总结 (1)</a></li>
<li class='category'><a href='/blog/categories/管理-沟通/'>管理，沟通 (1)</a></li>
<li class='category'><a href='/blog/categories/自动化测试/'>自动化测试 (1)</a></li>
<li class='category'><a href='/blog/categories/自动更新/'>自动更新 (1)</a></li>
<li class='category'><a href='/blog/categories/苹果审核被拒/'>苹果审核被拒 (1)</a></li>
<li class='category'><a href='/blog/categories/选择/'>选择 (1)</a></li>
<li class='category'><a href='/blog/categories/问题/'>问题 (1)</a></li>
<li class='category'><a href='/blog/categories/项目/'>项目 (2)</a></li>
<li class='category'><a href='/blog/categories/项目管理/'>项目管理 (1)</a></li>
<li class='category'><a href='/blog/categories/顽皮狗/'>顽皮狗 (2)</a></li>

 </ul>
</section>




  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2017 - newtomato -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
