
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>如何为第三方c++库导出luabinding (Part One) - 番茄手册</title>
  <meta name="author" content="newtomato">

  
  <meta name="description" content="上一篇文章讲到怎么使用liquidfunc,本章节讲述怎么将liquidfun通过luabinding的方式导出给lua使用。 cocos2dx在早期2.x时代，是通过tolua++和pkg的方式，导出成luabinding。现在已经是 3.x版本了，cocos2dx改进了这种导出方式， &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://www.newtomato.me/blog/2017/07/02/ru-he-wei-di-san-fang-c-plus-plus-ku-dao-chu-luabinding">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="番茄手册" type="application/atom+xml">
  <link href='http://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <div id="logo">
  	<div id="logoLeft">{</div>
  	<div id="logoText">think</div>
  	<div id="logoRight">}</div>
  	<div class="clear"></div>
  </div>
  <h1><a href="/">番茄手册</a></h1>
  
  <div class="clear"></div>
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:www.newtomato.me" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
   <li><a href="/about2">About</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      
        <h1 class="entry-title">如何为第三方c++库导出luabinding (Part One)</h1>
      
    
    
      <p class="meta">
        








  


<time datetime="2017-07-02T20:26:16+08:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


<div class="entry-content"><p>上一篇文章讲到怎么使用<code>liquidfunc</code>,本章节讲述怎么将liquidfun通过luabinding的方式导出给lua使用。</p>

<p>cocos2dx在早期2.x时代，是通过tolua++和pkg的方式，导出成luabinding。现在已经是 3.x版本了，cocos2dx改进了这种导出方式，我们只需要增加一个.ini的配置文件就可以了。</p>

<p>两种方式各有优劣。第一种方式最大的弊病就是花费很多时间在重复做一些事情，麻烦。<br />
第二种方法，看似节省了我们不少时间，但是如果对<code>genbindings.py</code>的原理不熟悉，会让我们对出的错误一头雾水。</p>

<!--more-->
<p>第一种方法按照如下原则，将头文件转为pkg文件即可。</p>

<pre><code>1.    enum keeps the same
2.    remove CC_DLL for the class defines, pay attention to multi inherites
3.    remove inline keyword for declaration and implementation
4.    remove public protect and private
5.    remove the decalration of class member variable
6.    keep static keyword
7.    remove memeber functions that declared as private or protected
</code></pre>

<p>在导出liquidfun的过程中，我采用了第二种方法。在此记录一下过程和遇到的问题。</p>

<h2 id="genbindingspy">使用<code>genbindings.py</code>的方式导出。</h2>

<p>在<code>cocos2d-x/tools/tolua</code>文件夹下面有genbindings.py文件。如果没有，有可能你用的cocos2dx的版本不在3.x以内。</p>

<p>执行py之前，请阅读此处文档，安装相关的工具。<a href="https://github.com/cocos2d/bindings-generator">Requirements</a></p>

<ul>
  <li>先将liquidfun仓库提供的Box2D覆盖cocos2dx原先的Box2D，有一些文件有变化。</li>
  <li>在<code>cocos2d-x/tools/tolua</code>里增加一个<code>cocos2dx_box2d.ini</code>的文件。（因为liquidfun依赖于box2D，因此我们需要先导出box2D）这里提供box2d.ini文件。<a href="media/14989759807211/cocos2dx_box2d.ini">cocos2dx_box2d.ini</a></li>
  <li>修改genbindings.py文件如下：</li>
</ul>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class=""><span class="line">cmd_args = {'cocos2dx_box2d.ini':('cocos2dx_box2d','lua_cocos2dx_box2d_auto')}</span></code></pre></td></tr></table></div></figure></notextile></div>

<ul>
  <li>运行如下命令：</li>
</ul>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class=""><span class="line">cd cocos2d-x/tools/tolua
</span><span class="line">./genbindings.py</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>最后看到生成了如下文件</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class=""><span class="line">cocos/scripting/lua-bindings/auto/lua_cocos2dx_box2d_auto.cpp
</span><span class="line">cocos/scripting/lua-bindings/auto/lua_cocos2dx_box2d_auto.hpp</span></code></pre></td></tr></table></div></figure></notextile></div>

<h2 id="cpp">使用生成的cpp文件</h2>

<p>将他们添加到工程中，<br />
<img src="http://7xuepc.com1.z0.glb.clouddn.com/2017-07-02-14989852241192.jpg" alt="=w250" /><br />
同时在cocos2d_lua_binding工程中<code>building setting-&gt;search paths</code>添加一条搜索路径。<code>$(SRCROOT)/../../../../external/Box2D</code></p>

<p>编译运行一下。</p>

<p>遇到的问题：</p>

<pre><code>1. `luaval_to_object`导出了5个参数，导致不兼容。
2.  enmu没有导出
3.  编译成功，链接失败。
</code></pre>

<p>第一个问题可以通过手动删除第五个参数解决。<br />
第二个问题，可以通过修改lua代码解决。<br />
第三个问题暂时没有找到原因。不知道哪里丢失了路径，导致link总是失败。此处留个坑，待下回处理。</p>

<h2 id="section">参考链接</h2>

<p>1.<a href="https://segmentfault.com/a/1190000000631630">Cocos2d-x下Lua调用自定义C++类和函数的最佳实践</a></p>

</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">newtomato</span></span>

      








  


<time datetime="2017-07-02T20:26:16+08:00" pubdate data-updated="true"></time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/box2d/'>box2d</a>, <a class='category' href='/blog/categories/luabing/'>luabing</a>, <a class='category' href='/blog/categories/tolua-plus-plus/'>tolua++</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://www.newtomato.me/blog/2017/07/02/ru-he-wei-di-san-fang-c-plus-plus-ku-dao-chu-luabinding" data-via="" data-counturl="http://www.newtomato.me/blog/2017/07/02/ru-he-wei-di-san-fang-c-plus-plus-ku-dao-chu-luabinding" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left articlenav" href="/blog/2017/06/25/ren-shi-liquidfun" title="Previous Post: 认识liquidFun（流体物理引擎）">&laquo; 认识liquidFun（流体物理引擎）</a>
      
      
        <a class="basic-alignment right articlenav" href="/blog/2017/07/15/jekins" title="Next Post: 使用jekins打造一个自动化编译流程">使用jekins打造一个自动化编译流程 &raquo;</a>
      
    </p>
  </footer>
</article>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2017/12/15/openglji-chu-zhi-mo-ban-huan-cun">OpenGL基础之模板缓存</a>
      </li>
    
      <li class="post">
        <a href="/blog/2017/12/09/openglji-chu-ju-zhen-zhi-shi">Opengl基础之矩阵和坐标</a>
      </li>
    
      <li class="post">
        <a href="/blog/2017/12/03/opengl-glitter">在xcode上运行opengl工程-使用Glitter</a>
      </li>
    
      <li class="post">
        <a href="/blog/2017/12/03/macshang-openglhuan-jing">在xcode上运行openGL工程</a>
      </li>
    
      <li class="post">
        <a href="/blog/2017/11/21/pygraphviz">安装pygraphviz遇到的问题</a>
      </li>
    
  </ul>
</section>
<section>
 <h1>Categories</h1>
 <ul id="categories">
  <li class='category'><a href='/blog/categories/2d/'>2d (2)</a></li>
<li class='category'><a href='/blog/categories/ads/'>ads (1)</a></li>
<li class='category'><a href='/blog/categories/android/'>android (6)</a></li>
<li class='category'><a href='/blog/categories/androidstudio/'>androidstudio (1)</a></li>
<li class='category'><a href='/blog/categories/android开发/'>android开发 (1)</a></li>
<li class='category'><a href='/blog/categories/apache/'>apache (1)</a></li>
<li class='category'><a href='/blog/categories/apk/'>apk (1)</a></li>
<li class='category'><a href='/blog/categories/atom/'>atom (1)</a></li>
<li class='category'><a href='/blog/categories/basic/'>basic (2)</a></li>
<li class='category'><a href='/blog/categories/blend/'>blend (1)</a></li>
<li class='category'><a href='/blog/categories/bm-subtract/'>bm_subtract (1)</a></li>
<li class='category'><a href='/blog/categories/box2d/'>box2d (2)</a></li>
<li class='category'><a href='/blog/categories/c-/'>c# (1)</a></li>
<li class='category'><a href='/blog/categories/c-/'>c++ (4)</a></li>
<li class='category'><a href='/blog/categories/ccfileutil/'>ccfileutil (1)</a></li>
<li class='category'><a href='/blog/categories/cocos2d-x/'>cocos2d-x (1)</a></li>
<li class='category'><a href='/blog/categories/cocos2dx/'>cocos2dx (6)</a></li>
<li class='category'><a href='/blog/categories/cocos2dx骨骼动画换装/'>cocos2dx骨骼动画换装 (1)</a></li>
<li class='category'><a href='/blog/categories/djnago-blog-zinnia/'>djnago-blog-zinnia (1)</a></li>
<li class='category'><a href='/blog/categories/dns64/'>dns64 (1)</a></li>
<li class='category'><a href='/blog/categories/facebook/'>facebook (1)</a></li>
<li class='category'><a href='/blog/categories/flavors/'>flavors (1)</a></li>
<li class='category'><a href='/blog/categories/game/'>game (2)</a></li>
<li class='category'><a href='/blog/categories/gdscript/'>gdscript (1)</a></li>
<li class='category'><a href='/blog/categories/git/'>git (5)</a></li>
<li class='category'><a href='/blog/categories/godot/'>godot (1)</a></li>
<li class='category'><a href='/blog/categories/google/'>google (2)</a></li>
<li class='category'><a href='/blog/categories/gradle/'>gradle (1)</a></li>
<li class='category'><a href='/blog/categories/iap/'>iap (1)</a></li>
<li class='category'><a href='/blog/categories/ios/'>ios (2)</a></li>
<li class='category'><a href='/blog/categories/ipv6/'>ipv6 (1)</a></li>
<li class='category'><a href='/blog/categories/java/'>java (1)</a></li>
<li class='category'><a href='/blog/categories/jekins/'>jekins (1)</a></li>
<li class='category'><a href='/blog/categories/jni/'>jni (1)</a></li>
<li class='category'><a href='/blog/categories/keystore/'>keystore (1)</a></li>
<li class='category'><a href='/blog/categories/keytool/'>keytool (1)</a></li>
<li class='category'><a href='/blog/categories/limbo/'>limbo (1)</a></li>
<li class='category'><a href='/blog/categories/linter-luacheck/'>linter-luacheck (1)</a></li>
<li class='category'><a href='/blog/categories/liquidfunc/'>liquidfunc (1)</a></li>
<li class='category'><a href='/blog/categories/log/'>log (1)</a></li>
<li class='category'><a href='/blog/categories/lua/'>lua (9)</a></li>
<li class='category'><a href='/blog/categories/luabing/'>luabing (2)</a></li>
<li class='category'><a href='/blog/categories/luacheck/'>luacheck (1)</a></li>
<li class='category'><a href='/blog/categories/mac/'>mac (2)</a></li>
<li class='category'><a href='/blog/categories/maker/'>maker (2)</a></li>
<li class='category'><a href='/blog/categories/mobile/'>mobile (1)</a></li>
<li class='category'><a href='/blog/categories/mode/'>mode (1)</a></li>
<li class='category'><a href='/blog/categories/obb/'>obb (2)</a></li>
<li class='category'><a href='/blog/categories/opengl/'>opengl (2)</a></li>
<li class='category'><a href='/blog/categories/platform/'>platform (1)</a></li>
<li class='category'><a href='/blog/categories/profiles/'>profiles (2)</a></li>
<li class='category'><a href='/blog/categories/provision/'>provision (2)</a></li>
<li class='category'><a href='/blog/categories/python/'>python (3)</a></li>
<li class='category'><a href='/blog/categories/quaternion/'>quaternion (1)</a></li>
<li class='category'><a href='/blog/categories/rebase/'>rebase (1)</a></li>
<li class='category'><a href='/blog/categories/require/'>require (1)</a></li>
<li class='category'><a href='/blog/categories/restapi/'>restapi (1)</a></li>
<li class='category'><a href='/blog/categories/serpent/'>serpent (1)</a></li>
<li class='category'><a href='/blog/categories/shell/'>shell (1)</a></li>
<li class='category'><a href='/blog/categories/sqlite3/'>sqlite3 (1)</a></li>
<li class='category'><a href='/blog/categories/stickerpack/'>stickerpack (1)</a></li>
<li class='category'><a href='/blog/categories/sublime/'>sublime (1)</a></li>
<li class='category'><a href='/blog/categories/svn/'>svn (1)</a></li>
<li class='category'><a href='/blog/categories/table/'>table (1)</a></li>
<li class='category'><a href='/blog/categories/tolua-/'>tolua++ (1)</a></li>
<li class='category'><a href='/blog/categories/typecho/'>typecho (1)</a></li>
<li class='category'><a href='/blog/categories/unity/'>unity (1)</a></li>
<li class='category'><a href='/blog/categories/unity2d/'>unity2d (1)</a></li>
<li class='category'><a href='/blog/categories/vector3/'>vector3 (1)</a></li>
<li class='category'><a href='/blog/categories/vim/'>vim (1)</a></li>
<li class='category'><a href='/blog/categories/wwdr/'>wwdr (1)</a></li>
<li class='category'><a href='/blog/categories/xcode/'>xcode (1)</a></li>
<li class='category'><a href='/blog/categories/个人网站/'>个人网站 (1)</a></li>
<li class='category'><a href='/blog/categories/人物控制移动/'>人物控制移动 (1)</a></li>
<li class='category'><a href='/blog/categories/冒泡/'>冒泡 (1)</a></li>
<li class='category'><a href='/blog/categories/加密/'>加密 (1)</a></li>
<li class='category'><a href='/blog/categories/动画工具/'>动画工具 (1)</a></li>
<li class='category'><a href='/blog/categories/命令行/'>命令行 (1)</a></li>
<li class='category'><a href='/blog/categories/工作/'>工作 (2)</a></li>
<li class='category'><a href='/blog/categories/快速/'>快速 (1)</a></li>
<li class='category'><a href='/blog/categories/思维发散/'>思维发散 (1)</a></li>
<li class='category'><a href='/blog/categories/总结/'>总结 (1)</a></li>
<li class='category'><a href='/blog/categories/排序/'>排序 (1)</a></li>
<li class='category'><a href='/blog/categories/提交大包/'>提交大包 (1)</a></li>
<li class='category'><a href='/blog/categories/插入/'>插入 (1)</a></li>
<li class='category'><a href='/blog/categories/改进/'>改进 (1)</a></li>
<li class='category'><a href='/blog/categories/效率/'>效率 (1)</a></li>
<li class='category'><a href='/blog/categories/模块化/'>模块化 (1)</a></li>
<li class='category'><a href='/blog/categories/模拟器/'>模拟器 (1)</a></li>
<li class='category'><a href='/blog/categories/游戏/'>游戏 (1)</a></li>
<li class='category'><a href='/blog/categories/游戏引擎/'>游戏引擎 (1)</a></li>
<li class='category'><a href='/blog/categories/游戏测试/'>游戏测试 (1)</a></li>
<li class='category'><a href='/blog/categories/漫威/'>漫威 (1)</a></li>
<li class='category'><a href='/blog/categories/热更/'>热更 (1)</a></li>
<li class='category'><a href='/blog/categories/神秘海域4/'>神秘海域4 (1)</a></li>
<li class='category'><a href='/blog/categories/第三方接入/'>第三方接入 (2)</a></li>
<li class='category'><a href='/blog/categories/算法/'>算法 (1)</a></li>
<li class='category'><a href='/blog/categories/管理总结/'>管理总结 (1)</a></li>
<li class='category'><a href='/blog/categories/管理-沟通/'>管理，沟通 (1)</a></li>
<li class='category'><a href='/blog/categories/胡思乱想/'>胡思乱想 (1)</a></li>
<li class='category'><a href='/blog/categories/脚本/'>脚本 (1)</a></li>
<li class='category'><a href='/blog/categories/自动化/'>自动化 (1)</a></li>
<li class='category'><a href='/blog/categories/自动化测试/'>自动化测试 (1)</a></li>
<li class='category'><a href='/blog/categories/自动更新/'>自动更新 (1)</a></li>
<li class='category'><a href='/blog/categories/苹果审核被拒/'>苹果审核被拒 (1)</a></li>
<li class='category'><a href='/blog/categories/选择/'>选择 (1)</a></li>
<li class='category'><a href='/blog/categories/问题/'>问题 (1)</a></li>
<li class='category'><a href='/blog/categories/项目/'>项目 (2)</a></li>
<li class='category'><a href='/blog/categories/项目管理/'>项目管理 (1)</a></li>
<li class='category'><a href='/blog/categories/顽皮狗/'>顽皮狗 (2)</a></li>

 </ul>
</section>




  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2017 - newtomato -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
